# Технический проект "Сервис отправки оповещений"

**Архитектор**: Евгений Климов / Название организации  
**Дата:** 10 октября 2023


### История версий

|    Дата    |     Автор      | Что изменилось                               |
|:----------:|:--------------:|:---------------------------------------------|
| 10.10.2023 | Евгений Климов | Создан документ, название и краткий обзор    |
| 10.10.2023 | Евгений Климов | Дополнена цель и ключевые особенности        |
| 10.10.2023 | Евгений Климов | Ключевые термины, определения, аббревиатуры  |
| 10.10.2023 | Евгений Климов | Границы проекта                              |
| 10.10.2023 | Евгений Климов | Требования: Функциональные, Нефункциональные |
| 10.10.2023 | Евгений Климов | Ограничения, Предложения                     |
| 11.10.2023 | Евгений Климов | Краткий обзор, Цель, Ключевые особенности    |
| 11.10.2023 | Евгений Климов | Границы проекта                              |
| 11.10.2023 | Евгений Климов | Ключевые термины, определения, аббревиатуры  |
| 11.10.2023 | Евгений Климов | Текущая архитектура, Целевая архитектура     |
| 12.10.2023 | Евгений Климов | ADR-001                                      |
| 12.10.2023 | Евгений Климов | ADR-002                                      |
| 12.10.2023 | Евгений Климов | ADR-003                                      |
| 12.10.2023 | Евгений Климов | ADR-004                                      |
| 12.10.2023 | Евгений Климов | ADR-005                                      |
| 12.10.2023 | Евгений Климов | ADR-006                                      |
| 12.10.2023 | Евгений Климов | ADR-007                                      |
| 12.10.2023 | Евгений Климов | ADR-008                                      |
| 12.10.2023 | Евгений Климов | ADR-009                                      |
| 12.10.2023 | Евгений Климов | ADR-010                                      |

### Краткий обзор

##### Название проекта: Сервис отправки оповещений

Система отправки оповещений - ключевая часть нашей инфраструктуры, предназначенная для обеспечения эффективной рассылки оповещений о событиях нашим пользователям и клиентам. Эта подсистема обеспечивает возможность отправки оповещений через три основных канала связи: email, SMS и push-уведомления для мобильных устройств.

##### Цель
Целью проекта является создание надежной и гибкой подсистемы отправки оповещений для обеспечения своевременного и персонализированного информирования пользователей и клиентов системы о важных событиях. Основной акцент делается на:
- Многоканальности: Гарантируется, что каждый пользователь получит уведомление в предпочтительном для него канале связи.
- Персонализации: Каждый пользователь может настроить, какие оповещения он хочет получать, а также указать контактные данные, необходимые для доставки.
- Надежности: Обеспечивается надежность и гарантия доставки оповещений, даже в случае временных проблем с сетью.
- Масштабируемости: Система разрабатывается с учетом возможности масштабирования, чтобы справиться с увеличением числа пользователей и объема оповещений.

##### КЛЮЧЕВЫЕ ОСОБЕННОСТИ
- ***Многоканальность:*** Подсистема предоставляет возможность отправки оповещений через три различных канала связи: email, SMS и push-уведомления для мобильных устройств. Это обеспечивает максимальное охватывание аудитории и учет индивидуальных предпочтений пользователей.
- ***Персонализация:*** Каждый пользователь может настроить, какие оповещения он хочет получать, а также указать контактные данные, необходимые для доставки. Это повышает комфорт и релевантность оповещений для каждого получателя.
- ***Надежность:*** Гарантируется доставка оповещений с использованием устойчивых механизмов и повторной попытки в случае неудачной отправки. Это обеспечивает надежность и уверенность в доставке важных сообщений.
- ***Шаблоны сообщений:*** Подсистема предоставляет возможность создания и использования шаблонов сообщений для различных видов событий. Это упрощает процесс создания и редактирования текста оповещений.
- ***Управление очередью:*** Система обеспечивает управление и приоритизацию оповещений в очереди, чтобы обеспечить равномерную и эффективную рассылку.
- ***Аналитика и мониторинг:*** Подсистема предоставляет инструменты для отслеживания статуса отправленных оповещений и анализа эффективности рассылки. Это позволяет оптимизировать процессы и повышать качество обслуживания.
- ***Масштабируемость:*** Разрабатываемая система спроектирована с учетом возможности горизонтального масштабирования. Это позволит поддерживать рост числа пользователей и объема оповещений.
- ***Безопасность:*** Обеспечивается шифрование данных и защита конфиденциальной информации пользователей. Это гарантирует сохранность данных и соблюдение стандартов безопасности.
- ***Прокси и защита:*** Система взаимодействует с внешними сервисами через прокси или другие механизмы защиты, обеспечивая безопасность и надежность операций.

Все это делает нашу систему отправки оповещений не только важным инструментом для укрепления нашей позиции на рынке, но и надежным средством для обеспечения информирования и обслуживания наших клиентов и пользователей.

### Введение

### Ключевые термины, определения, аббревиатуры

| Термин                                  | Определение                                                                                                                                                                                                                                                                              |
|:----------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| СУБД                                    | Система управления базами данных - это программное обеспечение, предназначенное для создания, управления и обслуживания баз данных, используемых для хранения и организации структурированной информации.                                                                                |
| SMS                                     | Short Message Service (сервис коротких сообщений) - это технология для отправки и получения текстовых сообщений, содержащих до 160 символов, на мобильные устройства.                                                                                                                    |
| Push-уведомления                        | Уведомления, отправляемые на мобильные устройства через специализированные приложения, обычно в режиме реального времени.                                                                                                                                                                |
| Электронная почта                       | Электронная почта (email) - это система электронной переписки через интернет, позволяющая отправлять и получать текстовые сообщения и файлы между пользователями с использованием уникальных адресов электронной почты.                                                                  |
| Многоканальность                        | Возможность отправки оповещений через несколько различных каналов связи для достижения максимального охвата аудитории.                                                                                                                                                                   |
| Персонализация                          | Процесс учета настроек пользователя для каждого канала связи, включая параметры включения/выключения, адрес электронной почты, номер телефона или логин для push-уведомлений.                                                                                                            |
| Шаблоны сообщений                       | Возможность создания и использования предварительно определенных шаблонов сообщений для различных видов событий.                                                                                                                                                                         |
| Управление очередью                     | Механизм, обеспечивающий управление и приоритизацию оповещений в очереди, обеспечивая равномерную нагрузку на систему.                                                                                                                                                                   |
| Масштабируемость                        | Разработка системы с учетом возможного роста числа пользователей и увеличения объема оповещений в будущем.                                                                                                                                                                               |
| API (Application Programming Interface) | Интерфейс программирования приложений - это набор правил и протоколов, позволяющих разным программам взаимодействовать между собой.                                                                                                                                                      |
| Email-гейты                             | Email-гейты представляют собой компоненты системы, ответственные за маршрутизацию и обработку электронных писем. Они осуществляют взаимодействие с внешними почтовыми серверами и обеспечивают передачу электронных оповещений, а также следят за состоянием доставки и обратной связью. |
| Деплой системы                          | Процесс размещения и настройки всех компонентов и ресурсов системы в целевой среде, где она будет функционировать. Он включает в себя установку и настройку программного обеспечения, баз данных, настройку сетей, а также запуск и проверку работоспособности системы.                  |

### Границы проекта
##### Включено:
- Разработка и реализация подсистемы отправки оповещений для трех каналов связи: email, SMS и push-уведомления для мобильных устройств.
- Создание механизма настройки оповещений для конечных пользователей, позволяющего им управлять настройками для каждого канала связи (включение/выключение, адрес электронной почты, номер телефона или логин для push-уведомлений).
- Гарантия доставки оповещений с использованием устойчивых механизмов и повторной попытки в случае неудачной отправки.
- Возможность создания и использования шаблонов сообщений для различных видов событий.
- Управление очередью оповещений для обеспечения равномерной нагрузки на систему.
- Внедрение аналитики и мониторинга для отслеживания статуса отправленных оповещений и анализа эффективности рассылки.
- Разработка с учетом будущего роста числа пользователей и увеличения объема оповещений.

##### Исключено:
- Проектирование внешних смс и email-гейтов, а также решение всех вопросов, связанных с внешними системами, так как основное направление проекта - отправка оповещений, и не включает в себя функции, выходящие за его рамки.
- Прямой доступ внешних систем к смс-рассылке без использования прокси или защитных механизмов, так как наша система обеспечивает безопасность и надежность операций через соответствующие механизмы.
- Взаимодействие внешних систем с нашей базой данных, так как внешние системы не пишут в нашу базу данных.
- Любые дополнительные функции, не связанные непосредственно с целью проекта, и не оговоренные включенными пунктами в границах проекта.

### Требования
#### Заинтересованные стороны
|      Сторона       |      Имя       | Роль/Должность | Интересы/Опасения                             |
|:------------------:|:--------------:|:--------------:|:----------------------------------------------|
| Инженерная команда | Евгений Климов |   Архитектор   | Согласованные и подробно описанные требования |

#### Функциональные требования
| Группа                      |   ID   | Описание                                                                                                                                            | Приоритет |
|:----------------------------|:------:|:----------------------------------------------------------------------------------------------------------------------------------------------------|:---------:|
| Рассылка оповещений         | FR-001 | Отправка оповещений по email                                                                                                                        |  Высокий  |
| Рассылка оповещений         | FR-002 | Отправка оповещений по SMS                                                                                                                          |  Высокий  |
| Рассылка оповещений         | FR-003 | Отправка оповещений через push-уведомления                                                                                                          |  Высокий  |
| Управление настройками      | FR-004 | Возможность конечных пользователей управлять настройками оповещений для каждого канала связи (вкл./выкл., адрес, номер, логин для push-уведомлений) |  Средний  |
| Механизм повторной отправки | FR-005 | Механизм повторной отправки оповещений при неудачной доставке                                                                                       |  Средний  |
| Управление очередью         | FR-006 | Управление и приоритизация оповещений в очереди                                                                                                     |  Средний  |
| Шаблоны сообщений           | FR-007 | Возможность создания и использования шаблонов сообщений для различных видов событий                                                                 |  Низкий   |
| Аналитика и мониторинг      | FR-008 | Внедрение аналитики и мониторинга для отслеживания статуса отправленных оповещений и анализа эффективности рассылки                                 |  Средний  |

#### Нефункциональные требования
| Группа             |   ID    | Описание                                                                                                         | Приоритет |
|:-------------------|:-------:|:-----------------------------------------------------------------------------------------------------------------|:---------:|
| Производительность | NFR-001 | Время реакции системы для 95% действий пользователей, включая отправку оповещений, не должно превышать 2 секунды |  Высокий  |
| Безопасность       | NFR-002 | Обеспечение шифрования данных и защиты конфиденциальной информации пользователей при передаче и хранении         |  Высокий  |
| Масштабируемость   | NFR-003 | Система должна быть способной масштабироваться для обслуживания роста числа пользователей и объема оповещений    |  Высокий  |

## Ограничения

|     Тип     |  ID   | Описание                                                                                                                                                                                                         |
|:-----------:|:-----:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Техническое | C-001 | Система оповещений должна обеспечивать горизонтальное масштабирование для обработки увеличения нагрузки путем добавления дополнительных узлов через балансировщик нагрузки.                                      |
| Техническое | C-002 | Система должна иметь защиту от прямого доступа внешних систем к функциональности SMS-рассылки и электронной почты. Все запросы от внешних систем должны осуществляться через прокси или другой механизм защиты.  |
| Техническое | C-003 | Система оповещений не должна взаимодействовать напрямую с базой данных внешних систем. Взаимодействие с внешними системами должно осуществляться только через определенные интерфейсы и API.                     |
| Техническое | C-004 | Система оповещений не должна пытаться решать задачи внешних систем или проектировать внешние смс и email-гейты. Ее функциональность ограничивается отправкой оповещений и учетом предпочтений для каналов связи. |
| Техническое | C-005 | Система должна иметь механизм хранимых сообщений с гарантией доставки (опционально) и обеспечивать корректное восстановление после отключения внешнего интернет-соединения.                                      |

#### Предположения

|  ID   | Описание                                                                                                                                                      |
|:-----:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| A-001 | Оповещения будут исходить только из существующих компонентов системы, таких как "Controller", "Foo" и "Bar".                                                  |
| A-002 | Система оповещений знает о наличии и настройках каналов связи (email, SMS, push-уведомления), и эта информация не зависит от остальных компонентов системы.   |
| A-003 | Настройки пользователей по каналам связи (вкл./выкл., адрес/номер/логин) будут применяться в соответствии с их предпочтениями при рассылке оповещений.        |
| A-004 | Ожидается, что пользователи будут активно использовать возможности настройки каналов связи и включения/выключения оповещений.                                 |
| A-005 | Система оповещений предназначена исключительно для внутреннего использования в рамках системы и не будет предоставляться внешним сторонам.                    |
| A-006 | Предполагается, что существующие компоненты системы будут предоставлять все необходимые данные и события для отправки оповещений.                             |
| A-007 | Все компоненты системы обладают достаточной производительностью и доступностью для обеспечения оперативной отправки оповещений.                               |
| A-008 | Сторонние API и сервисы, необходимые для отправки оповещений (например, почтовые серверы, SMS-шлюзы), будут доступны и функциональны в течение всего проекта. |

## Текущая архитектура

В текущей архитектуре у нас есть мобильное приложение, которое общается с компонентом "Controller", а он в свою очередь делает запросы к "Foo" и "Bar".

![alt text](static/current_arch.svg)


## Целевая архитектура
### Диаграмма контекста (C1):
![C1](static/c1.svg)

Предполагается, что любой из существующих компонентов может отправить оповещение пользователю. При этом существующие каналы связи и предпочтения по их использованию известны системе оповещений, компоненты остальной системы знать это не должны.

|   ID	   |   Дата	    |   Статус   |  	Участники	   | Решения                                                      |
|:-------:|:----------:|:----------:|:--------------:|:-------------------------------------------------------------|
| ADR-001 | 12.10.2023 | Предложено | Евгений Климов | Выбор технологии для отправки оповещений                     |
| ADR-002 | 12.10.2023 | Предложено | Евгений Климов | Создание хранилища для пользовательских настроек             |
| ADR-003 | 12.10.2023 | Предложено | Евгений Климов | Реализация механизма мультиплексирования и адресной отправки |
| ADR-004 | 12.10.2023 | Предложено | Евгений Климов | Обработка особенностей разных каналов связи                  |
| ADR-005 | 12.10.2023 | Предложено | Евгений Климов | Интеграция внешних систем                                    |
| ADR-006 | 12.10.2023 | Предложено | Евгений Климов | Логирование и мониторинг                                     |
| ADR-007 | 12.10.2023 | Предложено | Евгений Климов | Бизнес метрики                                               |
| ADR-008 | 12.10.2023 | Предложено | Евгений Климов | Очереди для обработки больших объемов                        |
| ADR-009 | 12.10.2023 | Предложено | Евгений Климов | Деплой системы оповещений в контейнерах (Kubernetes)         |
| ADR-010 | 12.10.2023 | Предложено | Евгений Климов | Обеспечение отказоустойчивости                               |